<!DOCTYPE html>
<html lang="fa">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>مدیریت وظایف</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      background: #f2f2f2;
      padding: 20px;
      direction: rtl;
      font-size: 16px;
    }

    .container {
      max-width: 700px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
    }

    h1 {
      text-align: center;
      color: #5a47d7;
    }

    label {
      display: block;
      margin-top: 10px;
    }

    input,
    textarea,
    button {
      width: 100%;
      margin-top: 5px;
      padding: 10px;
      font-family: 'Vazirmatn', sans-serif;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    #progressLabel,
    .jalali-date {
      margin-top: 5px;
      font-size: 14px;
      color: #555;
    }

    .task-card {
      background: #fff;
      border-radius: 8px;
      margin-top: 15px;
      padding: 15px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .progress-bar {
      height: 10px;
      background: #ccc;
      border-radius: 5px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress {
      height: 10px;
      background: #4caf50;
    }

    .task-actions button {
      width: 48%;
      margin-top: 10px;
      font-size: 14px;
    }

    .task-actions {
      display: flex;
      gap: 4%;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>مدیریت وظایف</h1>
    <label>عنوان وظیفه</label>
    <input type="text" id="taskTitle" placeholder="مثال: خرید کتاب">

    <label>توضیحات</label>
    <textarea id="taskDetails" placeholder="توضیحات اضافی..."></textarea>

    <div class="jalali-date" id="editTimestamp"></div>

    <label>تاریخ سررسید</label>
    <input type="date" id="taskDue" onchange="updateJalaliDate(this.value)">
    <div class="jalali-date" id="jalaliDisplay"></div>

    <label>پیشرفت</label>
    <input type="range" id="taskProgress" min="0" max="100" value="0" oninput="updateProgressLabel(this.value)">
    <div id="progressLabel">0%</div>

    <button onclick="saveTask()" id="submitBtn">افزودن وظیفه ➕</button>

    <div id="taskList"></div>
  </div>

  <script>
    let tasks = [];
    let editIndex = -1;

    function toJalali(gy, gm, gd) {
      const g_d_m = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
      let jy, jm, jd;
      gy = parseInt(gy);
      gm = parseInt(gm);
      gd = parseInt(gd);
      let gy2 = (gm > 1) ? (gy + 1) : gy;
      let days = 355666 + (365 * gy) + Math.floor((gy2 + 3) / 4)
        - Math.floor((gy2 + 99) / 100) + Math.floor((gy2 + 399) / 400) + gd + g_d_m[gm];
      jy = -1595 + (33 * Math.floor(days / 12053));
      days %= 12053;
      jy += 4 * Math.floor(days / 1461);
      days %= 1461;
      if (days > 365) {
        jy += Math.floor((days - 1) / 365);
        days = (days - 1) % 365;
      }
      jm = (days < 186) ? 1 + Math.floor(days / 31) : 7 + Math.floor((days - 186) / 30);
      jd = 1 + ((days < 186) ? (days % 31) : ((days - 186) % 30));
      return `${jy}/${jm}/${jd}`;
    }

    function updateJalaliDate(gDate) {
      const parts = gDate.split('-');
      if (parts.length === 3) {
        const jalali = toJalali(parts[0], parts[1] - 1, parts[2]);
        document.getElementById("jalaliDisplay").innerText = `تاریخ جلالی: ${jalali}`;
      }
    }

    function updateProgressLabel(val) {
      document.getElementById("progressLabel").innerText = val + '%';
    }

    function saveTask() {
      const title = document.getElementById("taskTitle").value;
      const details = document.getElementById("taskDetails").value;
      const due = document.getElementById("taskDue").value;
      const progress = document.getElementById("taskProgress").value;
      const task = { title, details, due, progress };

      if (editIndex > -1) {
        tasks[editIndex] = task;
        editIndex = -1;
        document.getElementById("submitBtn").innerText = 'افزودن وظیفه ➕';
      } else {
        tasks.push(task);
      }

      renderTasks();
      resetForm();
    }

    function renderTasks() {
      const list = document.getElementById("taskList");
      list.innerHTML = "";
      tasks.forEach((t, i) => {
        const card = document.createElement("div");
        card.className = "task-card";
        const jalali = t.due ? toJalali(t.due.split('-')[0], t.due.split('-')[1] - 1, t.due.split('-')[2]) : '';
        card.innerHTML = `
          <h3>${t.title}</h3>
          <p>${t.details}</p>
          <p>${t.due || ''}</p>
          <div class="progress-bar">
            <div class="progress" style="width:${t.progress}%"></div>
          </div>
          <p>پیشرفت: ${t.progress}%</p>
          <div class="task-actions">
            <button onclick="editTask(${i})">✏️ ویرایش</button>
            <button onclick="deleteTask(${i})">🗑 حذف</button>
          </div>
        `;
        list.appendChild(card);
      });
    }

    function editTask(index) {
      const task = tasks[index];
      document.getElementById("taskTitle").value = task.title;
      document.getElementById("taskDetails").value = task.details;
      document.getElementById("taskDue").value = task.due;
      document.getElementById("taskProgress").value = task.progress;
      updateProgressLabel(task.progress);
      updateJalaliDate(task.due);
      editIndex = index;
      document.getElementById("submitBtn").innerText = 'ذخیره تغییرات';
    }

    function deleteTask(index) {
      if (confirm('آیا مطمئنید؟')) {
        tasks.splice(index, 1);
        renderTasks();
      }
    }

    function resetForm() {
      document.getElementById("taskTitle").value = "";
      document.getElementById("taskDetails").value = "";
      document.getElementById("taskDue").value = "";
      document.getElementById("taskProgress").value = 0;
      document.getElementById("progressLabel").innerText = '0%';
      document.getElementById("jalaliDisplay").innerText = '';
      document.getElementById("editTimestamp").innerText = '';
    }

    renderTasks();
  </script>
</body>

</html>
